class UserActivityDetector {
  constructor(options = {}) {
    // Default options
    this.config = {
      inactivityThreshold: options.inactivityThreshold || 30, // seconds
      checkInterval: options.checkInterval || 5000, // milliseconds
      activityEvents: options.activityEvents || ['mousedown', 'mousemove', 'keydown', 'scroll', 'touchstart'],
      onStatusChange: options.onStatusChange || null // Callback for status changes
    };

    this.isActive = false;
    this.lastActive = new Date();

    // Debounced activity update
    this.updateActivity = (() => {
      let timeout;
      return () => {
        clearTimeout(timeout);
        timeout = setTimeout(() => {
          if (!this.isActive) {
            this.isActive = true;
            this.config.onStatusChange?.({ isActive: this.isActive, lastActive: this.lastActive });
            // console.log('User is active');
          }
          this.lastActive = new Date();
        }, 100);
      };
    })();

    // Add event listeners
    this.config.activityEvents.forEach(event =>
      document.addEventListener(event, this.updateActivity, true)
    );

    // Periodic activity check
    this.activityCheckInterval = setInterval(() => this.checkActivity(), this.config.checkInterval);
  }

  checkActivity() {
    const wasActive = this.isActive;
    this.isActive = (new Date() - this.lastActive) / 1000 <= this.config.inactivityThreshold;
    if (wasActive !== this.isActive) {
      this.config.onStatusChange?.({ isActive: this.isActive, lastActive: this.lastActive });
      // console.log(`User is ${this.isActive ? 'active' : 'inactive'}`);
    }
  }

  isUserActive() {
    return this.isActive;
  }

  lastActiveTime() {
    return this.lastActive;
  }

  destroy() {
    // Remove event listeners
    this.config.activityEvents.forEach(event =>
      document.removeEventListener(event, this.updateActivity, true)
    );

    // Clear interval
    clearInterval(this.activityCheckInterval);
  }

  onChange(callback) {
    this.config.onStatusChange = callback;
  }
}

